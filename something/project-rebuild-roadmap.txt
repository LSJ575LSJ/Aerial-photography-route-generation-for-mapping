项目复刻学习路线图
===========================================

项目概况
项目名称：无人机云台控制系统
技术栈：
  前端：Vue 3 + TypeScript + Element Plus + Vite
  后端：NestJS + Prisma + MySQL
  流媒体：MediaMTX (RTSP → WebRTC)
  对象存储：MinIO
  消息队列：MQTT
  容器化：Docker + Docker Compose

===========================================
第一阶段：基础环境搭建（2-3天）
===========================================

任务1.1：前端项目初始化
□ 创建 Vue 3 + Vite 项目
□ 安装 TypeScript
□ 安装 Element Plus UI 框架
□ 配置路由（Vue Router）
□ 配置状态管理（Pinia）
□ 创建基础布局（Login、主框架）

任务1.2：后端项目初始化
□ 创建 NestJS 项目
□ 安装 Prisma ORM
□ 配置 MySQL 数据库连接
□ 设置环境变量（.env 文件）
□ 配置 CORS（允许前端跨域）

任务1.3：Docker 环境搭建
□ 编写 docker-compose.yml
□ 配置 MySQL 容器
□ 配置网络（my-network）
□ 测试数据库连接

===========================================
第二阶段：用户认证系统（3-5天）
===========================================

任务2.1：数据库设计
□ 设计 User 表（schema.prisma）
  - id, username, email, password
  - isActive, createdAt, updatedAt
□ 执行数据库迁移（prisma db push）

任务2.2：后端用户模块
□ 创建 UserModule、UserController、UserService
□ 实现注册接口（POST /user/register）
  - 密码加密（bcrypt 或 argon2）
  - 数据验证（class-validator）
□ 实现登录接口（POST /user/login）
  - 验证用户名密码
  - 生成 JWT Token
□ 实现 JWT 认证守卫（JwtAuthGuard）

任务2.3：前端登录页面
□ 创建 Login.vue
  - 用户名、密码输入框
  - 登录按钮
□ 封装 HTTP 请求（axios）
□ 实现登录逻辑
  - 调用登录 API
  - 保存 Token 到 localStorage
  - 跳转到主页面
□ 添加路由守卫（未登录跳转到登录页）

===========================================
第三阶段：权限管理系统 RBAC（5-7天）
===========================================

任务3.1：数据库设计（RBAC 模型）
□ 设计 Role 表（角色）
□ 设计 Menu 表（菜单，支持层级）
□ 设计 UserRole 表（用户-角色关联）
□ 设计 RoleMenu 表（角色-菜单关联）
□ 设计 ApiEndpoint 表（API 端点权限）
□ 执行数据库迁移

任务3.2：后端权限模块
□ 创建 RbacModule
□ 实现 AdminInitService（初始化管理员数据）
□ 创建 rbac-data.ts（初始数据）
□ 实现 API 端点自动注册（装饰器）
□ 实现权限检查守卫

任务3.3：前端菜单系统
□ 获取用户菜单接口（GET /user/menus）
□ 创建侧边栏组件（AppSidebar.vue）
□ 动态渲染菜单（递归组件，支持多级）
□ 实现路由权限守卫（PermissionManager）

任务3.4：角色和用户管理页面
□ 角色管理页面（增删改查）
□ 用户管理页面（分配角色）
□ 权限列表页面（查看所有 API 端点）

===========================================
第四阶段：设备管理基础（3-5天）
===========================================

任务4.1：数据库设计
□ 设计 Device 表（统一设备表）
  - 基础信息：id, deviceNumber, name, type
  - 状态：status, isRegistered
  - JSON 字段：deviceInfo, configInfo, locationInfo
□ 设计 RoleDevice 表（角色-设备权限）
□ 设计 DevicePairing 表（机库-飞机配对）

任务4.2：后端设备模块
□ 创建 DeviceRegisterModule
□ 实现设备注册/注销接口
□ 实现设备列表查询（支持权限过滤）
□ 实现设备配对接口

任务4.3：前端设备管理页面
□ 创建 MainDevice.vue
□ 设备列表展示（DeviceTree 组件）
□ 设备注册/注销功能
□ 设备配对功能（机库-飞机）

===========================================
第五阶段：流媒体集成（5-7天）
===========================================

任务5.1：MediaMTX 服务集成
□ Docker Compose 添加 MediaMTX 容器
□ 配置 mediamtx.yml（端口、认证）
□ 后端创建 MediaMTXModule
□ 封装 MediaMTX API（挂载流、卸载流）

任务5.2：视频流挂载功能
□ 实现挂载 RTSP 流接口（POST /device/:id/mount-stream）
  - 读取设备的 configInfo.rtsp
  - 调用 MediaMTX API 创建路径
  - 更新设备的 configInfo.webrtc
□ 实现流状态查询接口
□ 实现流卸载接口

任务5.3：前端视频播放测试页面
□ 创建 MediaTest.vue（流测试页面）
□ 实现手动挂载流功能
  - 输入 RTSP URL 和路径名
  - 调用挂载 API
□ 显示已挂载流列表
□ iframe 播放器集成

===========================================
第六阶段：云台控制核心功能（7-10天）
===========================================

任务6.1：设备命令系统
□ 设计 DeviceCommand 表（命令记录）
□ 后端实现设备命令接口
  - 云台控制（上下左右居中）
  - 焦距控制（放大缩小）
  - 拍照录像
  - 飞行控制（RC 控制）
□ 封装各种命令类型（装饰器模式）

任务6.2：MQTT 集成（设备通信）
□ Docker Compose 添加 MQTT Broker
□ 后端 MQTT 模块
□ 实现命令下发（发送到 MQTT）
□ 实现遥测数据接收（MQTT 订阅）
□ Protocol Buffers 消息定义

任务6.3：前端云台控制页面
□ 创建 MainPtz.vue
□ 左侧设备列表（复用 DeviceTree）
□ 中央视频播放区域
  - 方案1：iframe 播放器
  - 方案2：video + WebRTC（性能更好）
□ 摇杆控制组件（JoystickControl）
  - 左摇杆：油门/航向
  - 右摇杆：俯仰/横滚
□ 云台控制面板（PtzControlPanel）
  - 方向按钮
  - 焦距滑块
  - 拍照/录像按钮
□ 起飞按钮组件

任务6.4：WebRTC 播放器实现
□ 学习 WebRTC 基础（Offer/Answer 机制）
□ 实现 WebRTC 连接逻辑
  - 创建 RTCPeerConnection
  - 添加 Transceiver（接收视频音频）
  - 创建 Offer
  - 发送 Offer 到 MediaMTX
  - 接收 Answer
  - 设置 RemoteDescription
□ 监听 ontrack 事件
□ 设置 video.srcObject

===========================================
第七阶段：业务功能扩展（按需）
===========================================

任务7.1：航线管理
□ 设计 FlightRoute 表
□ 后端航线 CRUD 接口
□ 前端地图集成（如 Leaflet、MapBox）
□ 航点标注和编辑

任务7.2：任务管理
□ 设计 Job 表（任务调度）
□ 后端任务 CRUD 接口
□ 定时任务功能（@nestjs/schedule）
□ 前端任务规划页面

任务7.3：媒体文件管理
□ MinIO 对象存储集成
□ 文件上传/下载接口
□ 图片/视频预览
□ 录像文件管理

任务7.4：监控和日志
□ 操作日志记录（Operation 表）
□ 系统监控（SystemMonitor 表）
□ 前端监控页面
□ 日志查询和筛选

===========================================
第八阶段：优化和部署（3-5天）
===========================================

任务8.1：性能优化
□ 数据库索引优化
□ API 响应缓存（Redis）
□ 前端懒加载和代码分割
□ WebRTC 连接池管理

任务8.2：安全加固
□ API 权限完善
□ SQL 注入防护
□ XSS 防护
□ HTTPS 配置

任务8.3：生产部署
□ 编写生产环境 Dockerfile
□ 配置 Nginx 反向代理
□ 配置 SSL 证书
□ 数据库备份策略
□ 日志收集（ELK 或类似）

===========================================
学习建议
===========================================

循序渐进
先跑通最小功能（登录→查看设备→播放视频）
再逐步添加复杂功能

模块化思维
每个功能独立开发，互不影响
前后端接口定义清晰

多查文档
NestJS 官方文档
Prisma 官方文档
Vue 3 官方文档
WebRTC MDN 文档

动手实践
不要只看代码，要自己敲一遍
遇到问题先尝试解决，再查资料

版本控制
每完成一个任务就 git commit
方便回滚和对比

===========================================
核心技术学习顺序
===========================================

1. TypeScript 基础
2. Vue 3 Composition API
3. NestJS 模块化架构
4. Prisma ORM 数据库操作
5. JWT 认证机制
6. RBAC 权限模型
7. WebRTC 实时通信
8. Docker 容器化部署
9. MQTT 消息队列
10. Protocol Buffers

===========================================
预估时间（全职学习）
===========================================

基础搭建：1-2 周
核心功能：3-4 周
完整系统：2-3 个月

兼职学习需要 2-3 倍时间

